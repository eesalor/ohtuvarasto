{% extends "base.html" %}

{% block title %}{{ warehouse.name }} - Details{% endblock %}

{% block content %}
    <a href="{{ url_for('index') }}" class="back-link">‚Üê Back to Warehouses</a>
    
    <h1>{{ warehouse.name }}</h1>
    <p style="color: #666; margin-bottom: 30px;">Warehouse #{{ warehouse.id }}</p>
    
    <div class="stats">
        <div class="stat-box">
            <div class="stat-label">Current Balance</div>
            <div class="stat-value">{{ "%.2f"|format(warehouse.varasto.saldo) }}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Total Capacity</div>
            <div class="stat-value">{{ "%.2f"|format(warehouse.varasto.tilavuus) }}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Available Space</div>
            <div class="stat-value">{{ "%.2f"|format(warehouse.varasto.paljonko_mahtuu()) }}</div>
        </div>
    </div>
    
    <div class="progress-bar">
        {% set percentage = (warehouse.varasto.saldo / warehouse.varasto.tilavuus * 100) if warehouse.varasto.tilavuus > 0 else 0 %}
        <div class="progress-fill" style="width: {{ percentage }}%">
            {{ "%.1f"|format(percentage) }}% Full
        </div>
    </div>
    
    <h2 style="margin-top: 40px;">Add Products</h2>
    
    <form method="POST" action="{{ url_for('add_product', warehouse_id=warehouse.id) }}">
        <div class="form-group">
            <label for="product_name">Select Product:</label>
            <select id="product_name" name="product_name" required>
                <option value="">-- Choose a product --</option>
                {% for product, default_qty in available_products.items() %}
                    <option value="{{ product }}">{{ product }} (suggested: {{ default_qty }} units)</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" step="0.01" min="0.01" required placeholder="e.g., 5.00">
            <small style="color: #666; display: block; margin-top: 5px;">
                Available space: {{ "%.2f"|format(warehouse.varasto.paljonko_mahtuu()) }} units
            </small>
        </div>
        
        <button type="submit" class="btn">Add Product</button>
    </form>
    
    <h2 style="margin-top: 40px;">Current Products</h2>
    
    {% if warehouse.products %}
        <table>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Quantity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product, qty in warehouse.products.items() %}
                    <tr>
                        <td>{{ product }}</td>
                        <td>{{ "%.2f"|format(qty) }} units</td>
                        <td>
                            <form method="POST" action="{{ url_for('remove_product', warehouse_id=warehouse.id, product_name=product) }}" 
                                  style="display: inline;" 
                                  onsubmit="return confirm('Are you sure you want to remove {{ product }}?')">
                                <button type="submit" class="btn btn-danger">Remove</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="text-align: center; padding: 40px 20px; color: #666; background: #f8f9fa; border-radius: 8px;">
            <p>No products in this warehouse yet.</p>
            <p style="margin-top: 10px;">Add products using the form above!</p>
        </div>
    {% endif %}
    
    <div class="actions" style="margin-top: 40px;">
        <a href="{{ url_for('edit_warehouse', warehouse_id=warehouse.id) }}" class="btn btn-secondary">Edit Warehouse</a>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to List</a>
    </div>
{% endblock %}
