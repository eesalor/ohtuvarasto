{% extends "base.html" %}

{% block title %}{{ warehouse.name }} - Details{% endblock %}

{% block content %}
    <a href="{{ url_for('index') }}" class="back-link">‚Üê Back to Warehouses</a>

    <h1>{{ warehouse.name }}</h1>
    <p style="color: #666; margin-bottom: 30px;">Warehouse #{{ warehouse.id }} ({{ warehouse_type|capitalize }})</p>

    <div class="stats">
        <div class="stat-box">
            <div class="stat-label">Current Balance</div>
            <div class="stat-value">{{ "%.2f"|format(warehouse.varasto.saldo) }}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Total Capacity</div>
            <div class="stat-value">{{ "%.2f"|format(warehouse.varasto.tilavuus) }}</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Available Space</div>
            <div class="stat-value">{{ "%.2f"|format(warehouse.varasto.paljonko_mahtuu()) }}</div>
        </div>
    </div>

    <div class="progress-bar">
        {% set percentage = (warehouse.varasto.saldo / warehouse.varasto.tilavuus * 100) if warehouse.varasto.tilavuus > 0 else 0 %}
        <div class="progress-fill" style="width: {{ percentage }}%">
            {{ "%.1f"|format(percentage) }}% Full
        </div>
    </div>

    <!-- Edit Warehouse Section -->
    <h2 style="margin-top: 40px;">Edit Warehouse</h2>

    <form method="POST">
        <input type="hidden" name="update_warehouse" value="1">
        <div class="form-group">
            <label for="name">Warehouse Name:</label>
            <input type="text" id="name" name="name" value="{{ warehouse.name }}" required>
            <small style="color: #666; display: block; margin-top: 5px;">Name must be unique</small>
        </div>

        <div class="form-group">
            <label for="capacity">Capacity:</label>
            <input type="number" id="capacity" name="capacity" step="0.01" min="{{ warehouse.varasto.saldo }}" value="{{ warehouse.varasto.tilavuus }}" required>
            <small style="color: #666; display: block; margin-top: 5px;">
                Minimum capacity: {{ "%.2f"|format(warehouse.varasto.saldo) }} (current balance)
            </small>
        </div>

        <button type="submit" class="btn">Update Warehouse</button>
    </form>

    <!-- Add Products Section -->
    <h2 style="margin-top: 40px;">Add Products</h2>

    <form method="POST" action="{{ url_for('add_product', warehouse_id=warehouse.id) }}">
        {% if warehouse_type == 'custom' %}
            <div class="form-group">
                <label for="custom_product_name">Product Name:</label>
                <input type="text" id="custom_product_name" name="custom_product_name" required placeholder="Enter product name">
            </div>
        {% else %}
            <div class="form-group">
                <label for="product_name">Select Product:</label>
                <select id="product_name" name="product_name" required>
                    <option value="">-- Choose a product --</option>
                    {% for product, default_qty in available_products.items() %}
                        <option value="{{ product }}">{{ product }} (suggested: {{ default_qty }} units)</option>
                    {% endfor %}
                </select>
            </div>
        {% endif %}

        <div class="form-group">
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" step="0.01" min="0.01" required placeholder="e.g., 5.00">
            <small style="color: #666; display: block; margin-top: 5px;">
                Available space: {{ "%.2f"|format(warehouse.varasto.paljonko_mahtuu()) }} units
            </small>
        </div>

        <button type="submit" class="btn">Add Product</button>
    </form>

    <!-- Current Products Section -->
    <h2 style="margin-top: 40px;">Current Products</h2>

    {% if warehouse.products %}
        <table>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Quantity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product, qty in warehouse.products.items() %}
                    <tr>
                        <td>{{ product }}</td>
                        <td>{{ "%.2f"|format(qty) }} units</td>
                        <td>
                            <form method="POST" action="{{ url_for('remove_product', warehouse_id=warehouse.id, product_name=product) }}"
                                  style="display: inline;"
                                  onsubmit="return confirm('Are you sure you want to remove {{ product }}?')">
                                <button type="submit" class="btn btn-danger">Remove</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="text-align: center; padding: 40px 20px; color: #666; background: #f8f9fa; border-radius: 8px;">
            <p>No products in this warehouse yet.</p>
            <p style="margin-top: 10px;">Add products using the form above!</p>
        </div>
    {% endif %}

    <!-- Danger Zone -->
    <hr style="margin: 40px 0; border: none; border-top: 1px solid #ddd;">

    <h3 style="color: #e74c3c;">Danger Zone</h3>
    <p style="color: #666; margin-bottom: 15px;">Deleting a warehouse cannot be undone.</p>
    <form method="POST" action="{{ url_for('delete_warehouse', warehouse_id=warehouse.id) }}"
          onsubmit="return confirm('Are you sure you want to delete this warehouse? This action cannot be undone.')">
        <button type="submit" class="btn btn-danger">Delete Warehouse</button>
    </form>

    <div class="actions" style="margin-top: 40px;">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to List</a>
    </div>
{% endblock %}
